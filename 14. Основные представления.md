# Основные представления

## Функциональное представление

Функциональное представление соответствует доменной модели и представлено на концептуальной архитектуре в разделе 13.

## Диаграмма вариантов использования

![use case](https://user-images.githubusercontent.com/124265597/222737642-dc5e50da-2a7d-4b5b-bc14-bbb18fc6ed06.png)


## Информационное представление

Информационное представление будет иметь следующую структуру:
![Информационное представление](https://user-images.githubusercontent.com/124265597/221882201-58e75260-402c-4f3f-aa5e-e0801079f9d3.png)


Информационное представление представлю в виде приблизительной оценки размера основных сущностей и частоты событий. На основе этой информации можно рассчитать необходимое пространство для хранения и оценку пропускной способности сети с прогнозами роста системы.
Рассматривается информационное представление только мобильного приложения

Для оценки возможных объемов хранимой информации необходимо учитывать ожидаемое количество пользователей приложения и типы данных, которые будут храниться.

Если рассматривать типы данных, которые будут храниться, то для объектов _"Тренировки"_ можно ожидать, что каждая тренировка будет содержать следующую информацию:

Дата и время тренировки: 8 байт (тип данных - datetime)

Длительность тренировки: 4 байта (тип данных - integer)

Тип тренировки: 10 байт (тип данных - string)

Результаты тренировки: 50 байт (тип данных - string)

Общий объем данных для каждой тренировки будет около 80 байт.


Для объектов _"Покупки"_ можно ожидать, что каждый товар будет содержать следующую информацию:

Наименование товара: 50 байт (тип данных - string)

Описание товара: 200 байт (тип данных - string)

Цена товара: 4 байта (тип данных - float)

Фотография товара: 200 Кб (тип данных - binary)

Общий объем данных для каждого товара будет зависеть от размера фотографии и будет примерно 200 Кб + 254 байта.


Для объектов _"Пользователь"_ можно ожидать, что каждый пользователь будет содержать следующую информацию:

Логин: 50 байт (тип данных - string)

Пароль: 50 байт (тип данных - string)

ФИО: 100 байт (тип данных - string)

Другая информация: 200 байт

Фотография товара: 200 Кб (тип данных - binary)

Общий объем данных для каждого Пользователя будет зависеть от размера фотографии и будет примерно 200 Кб + 400 байт.


Для объектов _"Уведомления"_ можно ожидать, что каждый пользователь будет получать следующую информацию:

Дата и время тренировки: 8 байт (тип данных - datetime)

Категория: 50 байт (тип данных - string)

Отметка о прочтении: 2 байт (тип данных - boolean)

Другая информация: 200 байт

Фотография товара: 100 Кб (тип данных - binary)

Общий объем данных для каждого уведомления будет достигать примерно 100 Кб + 260 байт.


Для объектов _"Сообщества"_ можно ожидать, что почти каждый пользователь будет состоять в сообществах и содержать о них следующую информацию:

Наименование: 50 байт (тип данных - string)

Вид спорта: 20 байт (тип данных - string)

Участники: 500 байт (тип данных - string)

Логотип сообщества: 100 Кб (тип данных - binary)

Общий объем данных для каждого сообщества будет достигать примерно 100 Кб + 570 байт.


Для объектов _"Устройства"_ можно ожидать, что почти каждый пользователь будет использовать IoT устройства и содержать о них следующую информацию:

Наименование: 20 байт (тип данных - string)

МАС-адрес: 6 байт (тип данных - string)

Другая информация: 100 байт

Общий объем данных для каждого устройства будет достигать примерно 126 байт.


Таким образом, если оценить ожидаемое количество пользователей и их активность, можно сделать приблизительную оценку объемов хранимой информации. Например, если ожидается, что каждый пользователь будет хранить в приложении информацию о 50 тренировках и в магазине будет доступно около 200 товаров, состоять в пяти сообществах, и пользоваться двумя IoT устройствами, и подписан на уведомления, то общий объем данных будет примерно следующим:

Рассчитаем объем информации для 1000 пользователей.

Для объектов "Тренировки": 50 * 80 байт * 1000 = 4 Мб
Для объектов "Продукты": 200 * (200 Кб + 254 байта) = 40 Мб
Для объекта "Пользователь": 201 Кб * 1000 = 2 Мб
Для объектов "Уведомления": 20 * 101 Кб * 1000 = 20 Мб
Для объектов "Сообщества": 101 Кб * 1000 = 1 Мб
Для объектов "Устройства": 2 * 126 байт * 1000 = 250 Кб
Оценка является приблизительной и первые тестовые запуски дадут более точную информацию.


## Инфраструктурное представление

Инфраструктурные вопросы мы отдаём на outsourcing, но вот список инфраструктурных решений, к которым мы стремимся. Список может быть подвергнут изменениям outsourcing компанией.
1. Kubernetes -- для развёртывания и управления приложениями. Тут же мы будем использовать health check-и. 
2. Grafana -- фронтенд для логов и метрик
3. Prometheus -- метрики
4. AlertManager -- триггеры, алерты
5. Clickhouse -- хранение логов и метрик


Сервер для хранения данных: приложение будет хранить данные пользователей (тренировки, историю, фотографии товаров и т.д.) на сервере. ДMicrosoft Azure справится с данной задачей.

База данных: для хранения данных можно использовать реляционную базу данных, такую как MySQL или PostgreSQL. База данных будет содержать таблицы для хранения пользовательской информации (тренировки, история, товары) и схему, определяющую связи между таблицами.

API: для обмена данными между приложением и сервером необходимо создать API. API может быть построен на базе RESTful-архитектуры и позволит клиентскому приложению получать и отправлять данные на сервер.

Мобильное приложение: клиентское приложение будет разработано под мобильные операционные системы iOS и Android. Для разработки приложения можно использовать интегрированную среду разработки, такую как Xcode для iOS или Android Studio для Android.

Платежный шлюз: для реализации встроенного интернет-магазина необходимо включить платежный шлюз в инфраструктуру приложения. Например, можно использовать Stripe или PayPal для обработки платежей. Данный выбору будет осуществляться при реализации приложения.

Аналитика: для мониторинга использования приложения и анализа данных будем использовать инструменты аналитики, они также будут определяться при реализации приложения.

## Многозадачность

   Така как весь функционал интернет магазина уже реализован в нашей компании (исходя из условий задания), то проблем с многозадачностью лежат полносью в плоскости того кто предоставляет нам API для работы с его системой. Мы работаем по правилам этого API и осуществляем требуемые от нас интеграции. 

   Что касается нашего приложения, то проблем с параллелизмом не предполагается. При росте нагрузки провайдер увеличит количество инстансов нашего приложения для уменьшения сбоев клиентских запросов. Большое количество одновременных работающих веб приложений не помешают друг другу, так как приложения не должны хранить какие-либо состояния. Все состояния хранятся в базе и все приложения имеют доступ до базы.
   Для описания многозадачности в приложении можно использовать многопоточность. Это позволит приложению выполнять несколько задач одновременно и обеспечит более быстрый и отзывчивый пользовательский интерфейс.

В приложении планируется использовать несколько потоков для выполнения следующих задач:

Поток для загрузки данных с сервера: при запуске приложения может быть запущен отдельный поток, который загружает данные с сервера (например, список товаров в интернет-магазине или список тренировок пользователя). Это позволит приложению быстро отобразить необходимые данные, не задерживая работу пользовательского интерфейса.

Поток для сохранения данных на сервере: при сохранении изменений, введенных пользователем (например, при добавлении новой тренировки), можно использовать отдельный поток, который отправляет данные на сервер. Это обеспечит более быструю и плавную работу приложения, поскольку пользователь сможет продолжать работать с приложением, пока данные сохраняются на сервере.

Поток для отслеживания изменений данных: для обеспечения более плавной работы приложения и быстрой обратной связи с пользователем, можно использовать поток, который отслеживает изменения данных (например, при добавлении новой тренировки). Этот поток может уведомлять пользователя о произошедших изменениях с помощью уведомлений.

Важно учитывать, что использование многопоточности может потребовать дополнительных ресурсов, таких как память и процессорное время. Поэтому необходимо обеспечить правильное управление потоками и оптимизировать их работу, чтобы избежать задержек и сбоев в работе приложения.


## Безопасность

При разработке ПО важно помнить о безопасности, в особенности регулярно проверять, что наши системы не подвережены OWASP Top 10 уязвимостям. Также важно обеспечить своевременность обновления ПО.

Значительную часть функционала безопасности реализует именно API Gateway. Важно настроить envoy, чтобы доступ к системе был только через https. Модуль curiefense предоставляет нам WAF с необходимой нам защитой.

Все внутренние сервисы находятся внутри VPN, поэтому мы можем не беспокоиться, что общение между нашими серверами будет перехвачено.

Данные баз данных хранятся в зашифрованном виде. 

Для обеспечения безопасности приложения для спортсменов можно рассмотреть следующие аспекты:

Аутентификация: приложение должно обеспечить безопасный вход для пользователей. Для этого может быть использована система аутентификации, например, логин и пароль, либо более современные методы, такие как аутентификация по отпечатку пальца, сканирование лица или распознавание голоса. Важно обеспечить надежность выбранной системы аутентификации.

Авторизация: после прохождения аутентификации приложение должно обеспечить авторизацию пользователя на уровне доступа к определенным функциональным возможностям приложения. Также необходимо предусмотреть различные уровни доступа для разных пользователей, например, администраторы магазина должны иметь возможность редактировать список товаров, а пользователи могут только просматривать товары.

Шифрование данных: для обеспечения безопасности хранимых данных необходимо использовать шифрование. Для этого можно использовать различные методы, например, шифрование на уровне базы данных или шифрование передаваемых данных между сервером и клиентом. Это обеспечит защиту от несанкционированного доступа к конфиденциальной информации, такой как данные пользователей, личная информация, история тренировок и т.д.

Защита от взлома: приложение должно быть защищено от взлома. Для этого необходимо проводить регулярные проверки на уязвимости, а также использовать защиту на уровне кода приложения.

Резервное копирование данных: для обеспечения сохранности данных в случае сбоев или атак на приложение необходимо регулярно создавать резервные копии данных. Копии данных можно сохранять в зашифрованном виде на удаленных серверах, что обеспечит их сохранность.

Соблюдение стандартов безопасности: при разработке приложения необходимо соблюдать стандарты безопасности, такие как GDPR и HIPAA, если это необходимо в соответствии с региональным законодательством. Это обеспечит соответствие приложения требованиям по безопасности и защите конфиденциальности данных пользователей.
