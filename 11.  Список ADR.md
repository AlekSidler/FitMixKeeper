# Список ADR

## Дата
19-02-2023

## Статус
ПРИНЯТ

## Выбор языка программирования:

  ## Контекст
  Изначальный выбор языков сужен до PHP и Go потому что встреча с командой покзала что данные инструменты наиболее "близки" команде. 

  ## PHP 
  - Проверенный временем инструмент
  - Широкий выбор фреймворков и библиотек
  - Не нужно зоботится о многопоточности
  - Проще выделить разработчиков внутри компании

  ## Go
  - Высокая производительность по сравнению с PHP
  - Строготипизированый
  - Дешевле масштабируется
  - Возможность вынести домен приложения в отдельный сервис без переписвания на другой язык
  - Совместим с AWS Lambda

  ## Решение
  Использовать для разработки бекенд-сервиса язык высокого уровня Go ^1.18

  ## Последствия
  - Необходимость в большом количестве разработчиков на Go


## Базы данных:

   Нужно выбрать основную релиционную базу данных. База данных - сердце нашего приложения, его память и мозг. На рынке есть два наиболее популярных представителя реляционных баз: MySQL, PostgreSQL. Поддерживать два типа баз одновременно не имеет никакого смысла. 

  ### Контекст:

  Выбор между MySQL и PostgreSQL часто сводится к следующим вопросам:

   1. Нам нужна многофункциональная СУБД, способная обрабатывать сложные запросы и поддерживать массивные базы данных? **Тогда выбираем базу данных PostgreSQL**.
  2. Нужна более легкая БД, относительно простая в настройке и управлении, быстрая, надежная и понятная? **Выбираем базу данных MySQL**.

  Ввиду того что у нас будут сложные модули по накоплению и обработке информации о пользователях, их тренировках, и групп в которых пользователь состоит, суть которых   обрабатывать сотни тысяч строк, то наш выбор - PostgreSQL. 

  ### Решение:

  - Данное решение полностью удовлетворяет нашим потребностям. 

## Облачный провайдер:

  Ввиду того что большинство имеющихся систем в нашей компании и так хоститсяв облаке, нет никакой причины размещать наш сервис on premises. Существует необходимость     выбрать одного основного конкретного провайдера, где будет размещаться наше приложение. Это нужно для большей совместимости с дополнительными cloud сервисами в         рамках провайдера. 

  Мы будем рассматривать наиболее зрелых представителей индустрии, это Google Cloud Platform и Amazon Web Services.

  Оба провайдера предоставляют идентичный функционал под разными названиями. 

  ‐ **Вычислительная функция**: Google Compute Engine and Google App Engine | Amazon Elastic Compute Cloud (EC2);

  ‐ **Функция хранения**: Google Cloud Storage | Amazon Simple Storage Service (S3) and Amazon Elastic Block Store (EBS);

  ‐ **Функции сети**: Google Virtual Private Cloud | Amazon Virtual Private Cloud (VPC);

  ‐ **База данных**: Google Cloud SQL, Google Cloud Firestore, and Google Cloud Bigtable | Amazon Relational Database Service (RDS) and Amazon DynamoDB.

  ### Описание:

  Мы выбираем GCP, потому что: 

  Есть несколько весомых причин, почему нам стоит перевести хранение своей информации на GCP. Одна из них — это прозрачность в использовании. В сравнении с AWS, у        которой в правилах использования не говорится о лишних тратах, GCP помогает своим клиентам максимально сократить их расходы при работе с облачным сервером. Также     при использовании GCP, вас ждут такие преимущества, как: 

  1. **Экономия с микросервисами.** Пользователи GCP могут развернуть 4000 контейнеров Docker, работающих в идеальной оркестровке через Google Kubernetes Engine. При     этом загрузка не будет требовать много памяти, тем самым упрощая процесс загрузки. 
    2. **Низкая совокупная стоимость для EDW.** ESG обнаружила, что пользователи GCP сократили затраты на 52% по сравнению с 41% сокращением затрат пользователей AWS.
  3. **Виртуальные машины по фиксированной цене**. Вытесняемые виртуальные машины (PVM) помогают экономить до 79% рабочих нагрузок, которые могут быть усложнены           техническими сбоями. 
  4. **Индивидуальные типы машин.** Экономьте до 48% ресурсов благодаря возможности выбирать любую конфигурацию и память облака. 

  ### Последствия:

  - Команда разработчиков рады принятому решению.

 ## API Gateway:
 
  ### Контекст:

  Нам нужно определиться с реализацией общих API Gateway (для заказов и для тренировок). Перед нами стоит следующий выбор: 

  * Google Apigee.
  * Google API Gateway.

  В тоже время необходимо определиться с API Gateway для склада.


  ### Описание:

  Выбор пал на Google API Gateway ввиду его дешевизны и крайней дороговизны Google Apigee, второй полный аналог первого, только с более простым и дружественным к         пользователю интерфейсом. 

  За Apigee провайдер требует чек в 200.000 долларов за самую простую конфигурацию. 

  Для складского сервиса выбираем API Gateway попроще, выбор пал на F5, так как в компании уже имеется готовое решение.

  ### Последствия:

  - Получаем дополнительный слой защиты.
  - Большие возможности по аналитике входящих соединений. 
  - Это не бесплатно. 

 ## Сервис рассылок:

  ### Контекст:

  Нужно принять решение относительно того как будет реализована доставка уведомлений. Выбор стоит между: 

  * Написать все самому.
  * Воспользоваться готовым решением cloud провайдера: Google Firebase Cloud Messaging.
  * Заказать у внешнего вендора.

  ### Описание:

  Зачем изобретать велосипед, конечно готовое решение. Писать свое решение КРАЙНЕ  трудозатратно и дорого, и влечет за собой кратное увеличение сложности проекта и его поддержки, не говоря уже о сложности реализации асинхронных высоконагруженных систем. Хранение сообщений не совсем простая задача и только лишь реляционной базой уже не обойдешься. Придется поддерживать уже и NoSQL базу в дополнение к тому зоопарку что есть/будет. Третий вариант никто в серьез не рассматривал.

  ### Последствия:

     Подключаемое из коробки решение полностью удовлетворило наши потребности. 
  - Первый vendor lock он трудный самый. 
  - Траты на облачного провайдера оказались приемлимыми. 
  - Для склада решение уже существует в компании.

  ## Сервис online оплаты:

  ### Контекст:

  Ввиду того что мы будем работать с платежными данными пользователей на нас распрострянются соотвественные законодательные ограничения. Мы не можем хранить информацию о картах в нашей базе, а если и можем то должны выполнять требования платежной системы Visa/Master и получать лицензию на их хранение = долго, дорого, незачем. 

  Существуют готовые решения которые за небольшой процент возьмут всю боль на себя. В качестве платежного провайдера были выбраны два варианта: 

  * Cloud Payments.
  * Tinkoff. 

  Команда разработчиков ратовала за "тинька", потому что существовал положительный опыт работы с ними, понятное SDK, хорошая документация. А вот к CP в этом плане есть вопросы. 

  ### Последствия:

  - Хороший старт к документированию решений. 
  - Возможно представленная выше стуктура не всегда будет удовлетворять наши потребности. 


